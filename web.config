<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <rewrite>
      <rules>
        <!-- One rule proxies everything to your dev server on 5173.
             ARR will also proxy WebSocket (HMR) if WebSocket Protocol is installed. -->
        <rule name="ProxyTo5173" stopProcessing="true">
          <match url="(.*)" />
          <action type="Rewrite" url="http://localhost:5173/{R:1}" appendQueryString="true" />
          <serverVariables>
            <set name="HTTP_X_FORWARDED_PROTO" value="{HTTPS}" />
            <set name="HTTP_X_FORWARDED_HOST" value="{HTTP_HOST}" />
            <set name="HTTP_X_FORWARDED_FOR" value="{REMOTE_ADDR}" />
          </serverVariables>
        </rule>
      </rules>
    </rewrite>

    <!-- Optional: bump proxy timeouts to tolerate slower dev builds -->
    <proxy>
      <reverseRewriteHostInResponseHeaders enabled="true" />
    </proxy>
  </system.webServer>
</configuration>
